<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b0f14" />
  <title>Compras — Control Minimal</title>

  <style>
    :root{
      --bg:#0b0f14;
      --card: rgba(255,255,255,.06);
      --line: rgba(255,255,255,.10);
      --text:#f3f4f6;
      --muted:#a6adbb;
      --accent:#0a84ff;
      --danger:#ff453a;
      --ok:#30d158;
      --shadow: 0 18px 60px rgba(0,0,0,.40);
      --r: 18px;
      --pad: 16px;
      --tap: 46px;
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }

    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(900px 520px at 20% 0%, rgba(10,132,255,.14), transparent 60%),
        radial-gradient(700px 480px at 90% 10%, rgba(48,209,88,.10), transparent 55%),
        var(--bg);
      color: var(--text);
      padding-bottom: calc(env(safe-area-inset-bottom) + 20px);
    }

    /* ================= TOP BAR ================= */
    .topbar{
      position: sticky;
      top:0;
      z-index: 20;
      padding: calc(env(safe-area-inset-top) + 10px) 14px 12px;
      backdrop-filter: blur(18px);
      background: rgba(10,10,12,.55);
      border-bottom: 1px solid var(--line);
    }
    .toprow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .brand{ display:flex; align-items:center; gap:10px; }
    .logo{
      width:40px;height:40px;border-radius:14px;
      display:grid;place-items:center;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.12);
      font-weight:900;
    }
    .title{ font-weight:900;font-size:16px; }
    .subtitle{ font-size:12px;color:var(--muted); }

    /* ================= BUTTONS ================= */
    .btn{
      height:var(--tap);
      padding:0 14px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:rgba(255,255,255,.06);
      color:var(--text);
      font-weight:800;
      cursor:pointer;
    }
    .btn-primary{
      background:rgba(10,132,255,.18);
      border-color:rgba(10,132,255,.40);
    }
    .btn-danger{
      background:rgba(255,69,58,.16);
      border-color:rgba(255,69,58,.40);
    }

    /* ================= LAYOUT ================= */
    .container{
      width:min(1100px,92vw);
      margin:14px auto 40px;
      display:grid;
      gap:12px;
    }
    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--r);
      padding:var(--pad);
      box-shadow:var(--shadow);
    }

    .grid2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    .grid3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; }

    /* ================= FORMS ================= */
    .field{ display:flex; flex-direction:column; gap:6px; }
    label{ font-size:12px;color:var(--muted);font-weight:800; }

    input, select{
      height:var(--tap);
      border-radius:14px;
      border:1px solid rgba(255,255,255,.12);
      background:#111827;
      color:var(--text);
      padding:0 12px;
      outline:none;
    }

    input:focus, select:focus{
      border-color:rgba(10,132,255,.55);
      box-shadow:0 0 0 3px rgba(10,132,255,.18);
    }

    /* ===== FIX CONTRASTE SELECT MÓVIL ===== */
    select{
      color-scheme: dark;
      background-color:#111827;
      color:#f3f4f6;
    }
    select option{
      background-color:#0f1720;
      color:#f3f4f6;
    }
    select:focus option{
      background-color:#0f1720;
      color:#f3f4f6;
    }

    .hint{ font-size:11px;color:var(--muted); }

    /* ================= LIST ================= */
    .item{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      padding:12px;
      margin-bottom:10px;
    }
    .itemTitle{ font-weight:900;font-size:14px; }
    .itemMeta{ font-size:12px;color:var(--muted);display:flex;gap:8px;flex-wrap:wrap; }
    .money{ font-weight:900;font-size:16px;text-align:right; }
    .miniBtns{ display:flex; gap:10px; margin-top:8px; justify-content:flex-end; }

    /* ================= SUMMARY ================= */
    .summaryGrid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
      margin-top:10px;
    }
    .sumCard{
      background:rgba(255,255,255,.05);
      border:1px solid rgba(255,255,255,.12);
      border-radius:16px;
      padding:12px;
    }
    .sumCard .k{ font-size:12px;color:var(--muted);font-weight:800; }
    .sumCard .v{ font-size:18px;font-weight:900; }

    @media(min-width:820px){
      .container{ grid-template-columns:1fr 1fr; }
      .span2{ grid-column:1/-1; }
      .summaryGrid{ grid-template-columns:repeat(4,1fr); }
    }
  </style>
</head>

<body>
<header class="topbar">
  <div class="toprow">
    <div class="brand">
      <div class="logo">MB</div>
      <div>
        <div class="title">Compras</div>
        <div class="subtitle">Control de presupuesto</div>
      </div>
    </div>
    <button class="btn" id="btnExport">Exportar</button>
  </div>
</header>

<main class="container">

  <!-- PRESUPUESTO -->
  <section class="card">
    <h3>Presupuesto disponible</h3>
    <div class="money" id="disponibleTxt">Q0.00</div>

    <div class="grid2" style="margin-top:10px;">
      <div class="field">
        <label>Definir presupuesto (Q)</label>
        <input id="presupuestoInput" type="number" step="0.01">
      </div>
      <div class="field">
        <label>Agregar fondos (Q)</label>
        <input id="agregarInput" type="number" step="0.01">
      </div>
    </div>

    <div class="grid2" style="margin-top:10px;">
      <button class="btn btn-primary" id="btnSetPresupuesto">Guardar</button>
      <button class="btn" id="btnAddFondos">Agregar</button>
    </div>
  </section>

  <!-- REGISTRAR -->
  <section class="card">
    <h3>Registrar compra</h3>
    <form id="formCompra">
      <div class="grid2">
        <div class="field">
          <label>Fecha</label>
          <input type="date" id="fecha">
        </div>
        <div class="field">
          <label>Distribución</label>
          <select id="distribucion">
            <option value="">Seleccionar</option>
            <option>Atlantic Plaza</option>
            <option>Roosevelt</option>
            <option>Planta</option>
            <option>Sancris</option>
          </select>
        </div>
      </div>

      <div class="field" style="margin-top:10px;">
        <label>Producto</label>
        <input id="producto">
      </div>

      <div class="grid3" style="margin-top:10px;">
        <div class="field">
          <label>Cantidad</label>
          <input id="cantidad" type="number" step="0.01">
        </div>
        <div class="field">
          <label>Precio (Q)</label>
          <input id="precio" type="number" step="0.01">
        </div>
        <div class="field">
          <label>Total</label>
          <input id="totalPreview" readonly>
        </div>
      </div>

      <input type="hidden" id="editId">

      <div class="grid2" style="margin-top:10px;">
        <button class="btn btn-primary">Guardar</button>
        <button class="btn" type="button" id="btnLimpiar">Limpiar</button>
      </div>
    </form>
  </section>

  <!-- LISTA -->
  <section class="card span2">
    <h3>Compras registradas</h3>
    <div id="list"></div>
    <div class="summaryGrid" id="summaryGrid"></div>
  </section>

</main>

<script>
  const KEYS={c:"compras",p:"presupuesto"};
  const $=i=>document.getElementById(i);

  const f=$("formCompra");
  const fecha=$("fecha"),dist=$("distribucion"),prod=$("producto");
  const cant=$("cantidad"),precio=$("precio"),totPrev=$("totalPreview");
  const dispTxt=$("disponibleTxt"),list=$("list"),sumGrid=$("summaryGrid");

  function n(v){return Number(v)||0}
  function m(v){return "Q"+n(v).toFixed(2)}
  function load(){return JSON.parse(localStorage.getItem(KEYS.c)||"[]")}
  function save(a){localStorage.setItem(KEYS.c,JSON.stringify(a))}
  function disp(){return n(localStorage.getItem(KEYS.p))}
  function setDisp(v){localStorage.setItem(KEYS.p,v)}

  function updateTotal(){ totPrev.value=m(n(cant.value)*n(precio.value)); }
  cant.oninput=precio.oninput=updateTotal;

  $("btnSetPresupuesto").onclick=()=>{setDisp(n($("presupuestoInput").value));render()}
  $("btnAddFondos").onclick=()=>{setDisp(disp()+n($("agregarInput").value));render()}

  f.onsubmit=e=>{
    e.preventDefault();
    const t=n(cant.value)*n(precio.value);
    setDisp(disp()-t);
    const a=load();
    a.push({fecha:fecha.value,dist:dist.value,prod:prod.value,total:t});
    save(a);f.reset();updateTotal();render();
  };

  function render(){
    dispTxt.textContent=m(disp());
    const a=load();
    list.innerHTML="";
    let sums={};
    a.forEach(r=>{
      sums[r.dist]=(sums[r.dist]||0)+r.total;
      list.innerHTML+=`
        <div class="item">
          <div class="itemTitle">${r.prod}</div>
          <div class="itemMeta">${r.fecha} • ${r.dist}</div>
          <div class="money">${m(r.total)}</div>
        </div>`;
    });
    sumGrid.innerHTML="";
    Object.keys(sums).forEach(k=>{
      sumGrid.innerHTML+=`
        <div class="sumCard">
          <div class="k">${k}</div>
          <div class="v">${m(sums[k])}</div>
        </div>`;
    });
  }

  fecha.value=new Date().toISOString().slice(0,10);
  render();
</script>
</body>
</html>
